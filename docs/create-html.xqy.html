<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xml:space="preserve"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>xqDoc -- Module</title><script language="JavaScript"><!--
        function popUp(URL) {
                 day = new Date();
                 id = day.getTime();
                 eval("page = window.open(URL, 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');")
                 page.focus();
        }
      --></script><script language="JavaScript"><!--
	    function litePopUp(str) {    
  		  OpenWindow=window.open('', 'xqdoccode', 'toolbar=0,scrollbars=1,location=0,statusbar=0,menubar=0,resizable=1,width=600,height=400,left = 412,top = 334');
  		  OpenWindow.document.write('<html xmlspace="preserve">');
  		  OpenWindow.document.write('<head>');
  		  OpenWindow.document.write('<title>xqDoc - Code Sample</title>');
  		  OpenWindow.document.write('</head>');  		    		    		  
  		  OpenWindow.document.write('<body xml:space="preserve">');
  		  OpenWindow.document.write('<pre>');
 		  OpenWindow.document.write(str);
 		  OpenWindow.document.write('</pre>');
  		  OpenWindow.document.write('</body>');
  		  OpenWindow.document.write('</html>');
  		  OpenWindow.document.close();
  		  page.focus();
        }
      --></script><style><!--
body		{
		font: 80% Verdana;
		}
table		{
		font-size: 100%;
		}
h1, h2, h3, h4, h5, h6
		{
		clear: both;
		float: none;
		}
h1		{
		font-size: 100%;
		margin: 0em;
		}
h2		{
		font-size: 180%;
		margin-bottom: -1em;
		margin-top: .3em;
		}
h3		{
		font-size: 150%;
		}	
h4		{
		font-size: 140%;
		background-color: #ccf;
		border-bottom: 1px solid #99f;
		width: 100%;
		}
h5		{
		margin: 1em 0em 0em 0em;
		font-size: 120%;
		}
h6		{
		margin: 0em 0em 0em 3em;
		font-style: italic;
		font: bold italic;
		font-size: 100%;
		}
#variables, #methods, #methoddetail
		{
		padding-left: 3em;
		margin-bottom: 1.4em;
		clear: both;
		float: none;
		}
#methods ul.method, #variables ul.method
		{
		margin: 1em 0em 0em;
		}
#methoddetail ul.method
		{
		margin: 0em;
		}
div.inexternal
		{
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail p
		{
		float: none;
		clear: both;
		padding-left: 2em;
		margin-bottom: 1em;
		}
div.methoddetail{
		padding-bottom: 1em;
		}
div.methoddetail li
		{
		list-style-type: none;
		font-weight: bold;
		}
div.methoddetail li li
		{
		list-style-type: circle;
		font-weight: normal;
		}
div.methoddetail li ul
		{
		padding-bottom: 0.5em;
		font-weight: normal;
		}
table.inexternal{
		clear: both;
		float: none;
		width: 80%;
		margin-left: 3em;
		padding: 0em;
		
		}
table.inexternal th
		{
		background-color:#dedede;
		width: 50%;
		}			
td		{
		vertical-align: top;
		}
div.description {
		margin-top: .5em;
		font-weight: normal;
		padding-left: 1em;
		}
ul.method	{
		clear: both;
		float: none;
		width: 90%;
		list-style-type: none;
		border-top: 1px solid #ccc;
		}
ul.method li.left
		{
		float: left;
		clear: none;
		width: 40%;
		font-weight: bold;
		margin-bottom: 2em;
		}
ul.method li.right
		{
		position: relative;
            top: 0em;
		float: left;
            width: 55%;
		margin-bottom: 2em;
		padding-left: 2em;
		}
div.home 	{
		width: 60%;
		float: left;
		margin-right: 1%;
		border: 1px
		}
div.home h4	{
		font-size: 120%;
		background-color: #fff;
		border-bottom: 1px solid #99f;
		width: 100%;
		margin-bottom: -1em;
		}
div.overview p {
               width: 60%;
               }
     
 --></style></head><body><h4>Module URI</h4><h1>http://www.marklogic.com/tutorial2/create-html</h1><h4>Variables</h4><div id="variables"><div><a name="$DELIM"></a><ul class="method"><li class="left">$DELIM</li><li class="right"></li></ul><ul></ul></div></div>&nbsp;<h4>Imported Modules</h4><div id="imports"><div><ul class="method"><li class="left">http://www.marklogic.com/tutorial2/sidebar</li><li class="right"></li></ul><ul></ul></div><div><ul class="method"><li class="left">http://www.marklogic.com/tutorial2/extract-data</li><li class="right"></li></ul><ul></ul></div><div><ul class="method"><li class="left">http://marklogic.com/appservices/search</li><li class="right"></li></ul><ul></ul></div></div>&nbsp;<h4>Function Summary</h4><div id="methods"><a name="methods"></a><ul class="method"><li class="left"><a href="#body">body</a><div class="description"></div></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul class="method"><li class="left"><a href="#export">export</a><div class="description"></div></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul class="method"><li class="left"><a href="#full">full</a><div class="description"></div></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul class="method"><li class="left"><a href="#metrics">metrics</a><div class="description"></div></li><li class="right">( $search-response as element(search:response))<br><br></li></ul></div>&nbsp;<h4>Function Detail</h4><div id="methoddetail"><div id="body" class="methoddetail"><h5><a name="body"></a>body</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function create-html:body($search-response as element(search:response), $query as xs:string){<br/&gt;    let $highlight-query := fn:replace($query, fn:concat($DELIM,&#34;[^\s]*:[^\s]*&#34;), &#34;&#34;)<br/&gt;    for $result in $search-response/search:result<br/&gt;    let $uri := $result/@uri<br/&gt;    let $uriSuffix := substring($uri, 20)<br/&gt;    let $article := fn:doc($uri)<br/&gt;    let $pub-date := extract-data:get-pub-date($article)/text()<br/&gt;    let $archive := ($pub-date &amp;lt; &#34;1990-01-01&#34;)<br/&gt;    return <br/&gt;        &amp;lt;div class=&#34;result-title&#34;&amp;gt;<br/&gt;            &amp;lt;div&amp;gt;<br/&gt;                &amp;lt;h4 style=&#34;font-family:arial, sans-serif;font-size:10px;font-weight:bold;color:#ff3300;margin-top:0px;margin-right:0;margin-bottom:5px;margin-left:0;padding-top:5px;text-transform:uppercase;border-top:0&#34;&amp;gt;<br/&gt;                    { extract-data:get-category($article)/text() }<br/&gt;                &amp;lt;/h4&amp;gt;<br/&gt;                &amp;lt;h1 style=&#34;width:700px;font-family:times new roman,serif;font-size:18px;line-height:18px;font-weight:normal;color:#000000;margin-top:0px;margin-right:0;margin-bottom:2px;margin-left:0;padding:0&#34;&amp;gt;<br/&gt;                    &amp;lt;a href=&#34;http://www.nejm.org/doi/full/{extract-data:get-doi($article)}&#34; target=&#34;_blank&#34;&amp;gt;<br/&gt;                        { let $title := extract-data:get-article-title($article)<br/&gt;                          return if ($title) <br/&gt;                                 then if ($highlight-query)<br/&gt;                                      then cts:highlight(extract-data:get-article-title($article),$highlight-query,&amp;lt;mark&amp;gt;{$cts:text}&amp;lt;/mark&amp;gt;) <br/&gt;                                      else $title/string()<br/&gt;                                 else () }<br/&gt;                    &amp;lt;/a&amp;gt;<br/&gt;                    { if ($archive)<br/&gt;                      then &amp;lt;img src=&#34;http://www.nejm.org/templates/jsp/_style2/_mms/_nejm/img/archive_indictr.png&#34; /&amp;gt;<br/&gt;                      else () }<br/&gt;                &amp;lt;/h1&amp;gt;<br/&gt;                &amp;lt;span style=&#34;font-family: Arial, Helvetica, sans-serif;font-size: 12px;line-height: 14px;font-weight: normal;color:grey;margin-top: 0;margin-right: 0;margin-bottom: 0px;margin-left: 0;padding: 0;&#34;&amp;gt;<br/&gt;                    by: { for $author in extract-data:get-authors($article)<br/&gt;                          return &amp;lt;text&amp;gt; { $author/name/surname }, {$author/name/given-names }; &amp;lt;/text&amp;gt; }<br/&gt;                &amp;lt;/span&amp;gt;<br/&gt;                &amp;lt;br/&amp;gt;<br/&gt;                <br/&gt;                &amp;lt;span style=&#34;font-family: Arial, Helvetica, sans-serif;font-size: 10px;line-height: 12px;font-weight: normal;color: #000000;margin-top: 0;margin-right: 0;margin-bottom: 15px;margin-left: 0;padding: 0;&#34;&amp;gt;<br/&gt;                    { $pub-date } | { extract-data:get-journal-title($article) } | { extract-data:get-volume-page($article) } | {extract-data:get-doi($article) }<br/&gt;                &amp;lt;/span&amp;gt;<br/&gt;                &amp;lt;br/&amp;gt;<br/&gt;                &amp;lt;span style=&#34;font-family: Arial, Helvetica, sans-serif;font-size: 13px;line-height: 15px;font-weight: normal;color: #000000;margin-top: 0;margin-right: 0;margin-bottom: 15px;margin-left: 0;padding: 0;&#34;&amp;gt;<br/&gt;                    { let $abstract := extract-data:get-abstract($article)<br/&gt;                      return if ($abstract instance of node())<br/&gt;                             then if ($highlight-query) <br/&gt;                                  then cts:highlight($abstract, $highlight-query, &amp;lt;mark&amp;gt;{$cts:text}&amp;lt;/mark&amp;gt;)<br/&gt;                                  else $abstract/string()<br/&gt;                             else () }<br/&gt;                &amp;lt;/span&amp;gt;<br/&gt;                &amp;lt;br/&amp;gt;      <br/&gt;                &amp;lt;span&amp;gt;<br/&gt;                    { extract-data:get-images($article) }<br/&gt;                &amp;lt;/span&amp;gt;<br/&gt;                                <br/&gt;                &amp;lt;br/&amp;gt;<br/&gt;                                <br/&gt;                { extract-data:get-renditions($article) }<br/&gt;            &amp;lt;/div&amp;gt;<br/&gt;        &amp;lt;/div&amp;gt; <br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="10">http://www.marklogic.com/tutorial2/extract-data</td><td>get-abstract</td></tr><tr><td>get-article-title</td></tr><tr><td>get-authors</td></tr><tr><td>get-category</td></tr><tr><td>get-doi</td></tr><tr><td>get-images</td></tr><tr><td>get-journal-title</td></tr><tr><td>get-pub-date</td></tr><tr><td>get-renditions</td></tr><tr><td>get-volume-page</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="5">http://www.w3.org/2005/xpath-functions</td><td>concat</td></tr><tr><td>doc</td></tr><tr><td>replace</td></tr><tr><td>string</td></tr><tr><td>substring</td></tr></table></div><div class="methoddetail"><h6>Internal Functions that invoke this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.marklogic.com/tutorial2/create-html</td><td><a href="#export">export</a></td></tr><tr><td><a href="#full">full</a></td></tr></table></div></div>&nbsp;<div id="export" class="methoddetail"><h5><a name="export"></a>export</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function create-html:export($search-response as element(search:response), $query as xs:string){<br/&gt;    &amp;lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&amp;gt;<br/&gt;        &amp;lt;head&amp;gt;<br/&gt;            &amp;lt;title&amp;gt;NEJM Search (HTML)&amp;lt;/title&amp;gt;<br/&gt;            &amp;lt;script src=&#34;/application/lib/external/jquery-1.7.1.min.js&#34; type=&#34;text/javascript&#34;&amp;gt;&amp;lt;/script&amp;gt;<br/&gt;            &amp;lt;script src=&#34;search.js&#34; type=&#34;text/javascript&#34;&amp;gt;&amp;lt;/script&amp;gt;<br/&gt;            &amp;lt;link type=&#34;text/css&#34; rel=&#34;stylesheet&#34; href=&#34;/css/page-layout.css&#34; media=&#34;screen, print&#34; /&amp;gt;<br/&gt;        &amp;lt;/head&amp;gt;<br/&gt;        &amp;lt;body&amp;gt;<br/&gt;            {create-html:body($search-response, $query)}<br/&gt;        &amp;lt;/body&amp;gt;<br/&gt;    &amp;lt;/html&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul></ul><div class="methoddetail"><h6>Internal Functions used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.marklogic.com/tutorial2/create-html</td><td><a href="#body">body</a></td></tr></table></div></div>&nbsp;<div id="full" class="methoddetail"><h5><a name="full"></a>full</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function create-html:full($search-response as element(search:response), $query as xs:string){<br/&gt;    let $facets := $search-response/search:facet<br/&gt;    let $response-total := $search-response/@total<br/&gt;    let $result-metrics := create-html:metrics($search-response)<br/&gt;    return <br/&gt;        &amp;lt;span&amp;gt;<br/&gt;            &amp;lt;div id=&#34;sidebar&#34;&amp;gt;<br/&gt;                &amp;lt;!-- { $search-response/search:metrics } --&amp;gt;<br/&gt;                { sidebar:create-chiclets($query) }<br/&gt;                { sidebar:create-facets($facets) }<br/&gt;            &amp;lt;/div&amp;gt;<br/&gt;            &amp;lt;div id=&#34;results&#34;&amp;gt;<br/&gt;                { $result-metrics }<br/&gt;                { create-html:body($search-response, $query) }<br/&gt;                { if ($response-total &amp;gt; 0) then $result-metrics else () }<br/&gt;                      <br/&gt;                &amp;lt;div id=&#34;formats&#34;&amp;gt;<br/&gt;                    &amp;lt;span&amp;gt;Output Formats:&amp;lt;/span&amp;gt;<br/&gt;                    &amp;lt;span class=&#34;export&#34; type=&#34;xml&#34;&amp;gt;XML&amp;lt;/span&amp;gt; <br/&gt;                    &amp;lt;span class=&#34;export&#34; type=&#34;json&#34;&amp;gt;JSON&amp;lt;/span&amp;gt; <br/&gt;                    &amp;lt;span class=&#34;export&#34; type=&#34;rss&#34;&amp;gt;RSS&amp;lt;/span&amp;gt; <br/&gt;                    &amp;lt;span class=&#34;export&#34; type=&#34;csv&#34;&amp;gt;CSV&amp;lt;/span&amp;gt; <br/&gt;                    &amp;lt;span class=&#34;export&#34; type=&#34;html&#34;&amp;gt;HTML&amp;lt;/span&amp;gt; <br/&gt;                &amp;lt;/div&amp;gt;<br/&gt;            &amp;lt;/div&amp;gt;<br/&gt;        &amp;lt;/span&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-response as element(search:response) ,<br>&nbsp; $query as xs:string)<br><br></li></ul><ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.marklogic.com/tutorial2/sidebar</td><td>create-chiclets</td></tr><tr><td>create-facets</td></tr></table></div><div class="methoddetail"><h6>Internal Functions used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="2">http://www.marklogic.com/tutorial2/create-html</td><td><a href="#body">body</a></td></tr><tr><td><a href="#metrics">metrics</a></td></tr></table></div></div>&nbsp;<div id="metrics" class="methoddetail"><h5><a name="metrics"></a>metrics</h5><ul class="method"><li class="left"><a href="javascript:litePopUp('declare function create-html:metrics($search-response as element(search:response)){<br/&gt;    let $response-total := $search-response/@total<br/&gt;    let $response-start := $search-response/@start<br/&gt;    let $response-page-length := $search-response/@page-length<br/&gt;    return <br/&gt;        &amp;lt;div class=&#34;result-metrics&#34;&amp;gt;<br/&gt;            &amp;lt;div&amp;gt;<br/&gt;                &amp;lt;a class=&#34;previous&#34;&amp;gt;prev&amp;lt;/a&amp;gt;<br/&gt;                Retrieved Articles {$response-start/data()} to {fn:min(($response-total/data(),$response-start/data() + $response-page-length/data() - 1))} <br/&gt;                of {$response-total/data()} total results in <br/&gt;                { try { xs:decimal(fn:substring-before(fn:substring($search-response/search:metrics/search:total-time/text(),3),&#34;S&#34;))*1000 } <br/&gt;                  catch ($exception) { () } }ms<br/&gt;                { if ($response-start/data() + $response-page-length/data() - 1 &amp;lt; $response-total) then &amp;lt;a class=&#34;next&#34;&amp;gt;next&amp;lt;/a&amp;gt; else ()}<br/&gt;            &amp;lt;/div&amp;gt;<br/&gt;        &amp;lt;/div&amp;gt;<br/&gt;};<br/&gt;')">
         view code
      </a></li><li class="right">( $search-response as element(search:response))<br><br></li></ul><ul></ul><div class="methoddetail"><h6>External Functions that are used by this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="4">http://www.w3.org/2005/xpath-functions</td><td>data</td></tr><tr><td>min</td></tr><tr><td>substring</td></tr><tr><td>substring-before</td></tr></table></div><div class="methoddetail"><h6>Internal Functions that invoke this Function</h6><table class="inexternal"><tr><th align="left">Module URI</th><th align="left">Function Name</th></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td rowspan="1">http://www.marklogic.com/tutorial2/create-html</td><td><a href="#full">full</a></td></tr></table></div></div>&nbsp;</div>&nbsp;<div align="left"><i>Created by xqDoc-Lite version 1.0 on Mon Aug 25 10:43:59 EDT 2014</i></div></body></html>